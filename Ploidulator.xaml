<Window  x:Class="Ploidulator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         xmlns:charting="clr-namespace:System.Windows.Controls.DataVisualization.Charting;assembly=System.Windows.Controls.DataVisualization.Toolkit"
        xmlns:visualisation="clr-namespace:System.Windows.Controls.DataVisualization;assembly=System.Windows.Controls.DataVisualization.Toolkit"
        xmlns:chartingprimitives="clr-namespace:System.Windows.Controls.DataVisualization.Charting.Primitives;assembly=System.Windows.Controls.DataVisualization.Toolkit"
        
        Title="Ploidulator BAM cluster analysis and filtering tool" Height="580" Width="800" 
        VerticalAlignment="Center" HorizontalAlignment="Center"   
        MinWidth="800" MinHeight="580" WindowStartupLocation="CenterScreen"
        Closing="Window_Closing">


    <!--Entire window contents-->
    <DockPanel LastChildFill="True">

        <!--Top level menu-->
        <DockPanel DockPanel.Dock="Top" Background="{DynamicResource {x:Static SystemColors.AppWorkspaceBrushKey}}" >
            <Grid>
                <Button  Content="Begin"  HorizontalAlignment="Left"  Name="button1" Cursor="Hand" Width="50" Margin="2"
                        MouseEnter="ShowBeginMenu" 
                        Click="ShowBeginMenu" Background="{x:Null}" />
                <Button  Content="Save"  HorizontalAlignment="Left"  Name="SaveButton" Cursor="Hand" Width="50" Margin="54,2"
                        MouseEnter="ShowSaveMenu" 
                        Click="ShowSaveMenu" Background="{x:Null}" />
                <Button  Content="Abort"  HorizontalAlignment="Left"  Name="AbortMenuButton" Cursor="Hand" Width="50" Margin="108,2"
                        MouseEnter="ShowAbortMenu" 
                        Click="ShowAbortMenu" Background="{x:Null}" />
                <Button  Content="Help"  HorizontalAlignment="Left"  Name="button2" Cursor="Hand" Width="50" Margin="162,2"
                        MouseEnter="ShowHelpMenu" 
                        Click="ShowHelpMenu" Background="{x:Null}" />
            </Grid>
            <Label DockPanel.Dock="Right" HorizontalAlignment="Right">Powered by .NET Bio</Label>
        </DockPanel>

        <!--Second level menu-->
        <DockPanel DockPanel.Dock="Top" Height="auto">
            <Grid>
                <Menu  Name="BeginMenu"  Visibility="Hidden"  HorizontalAlignment="Left"  VerticalAlignment="Top"  Cursor="Hand"
                   MouseLeave="Begin_Menu_Close" >
                    <MenuItem >
                        <MenuItem.Header>
                            <DockPanel>
                                <Label MouseDown="ShowInputMenu">Input file and parameters</Label>
                            </DockPanel>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem >
                        <MenuItem.Header>
                            <DockPanel>
                                <Label MouseDown="ShowOutputMenu">Output files</Label>
                            </DockPanel>
                        </MenuItem.Header>

                    </MenuItem>
                </Menu>
                <Menu  Name="SaveMenu"  Visibility="Hidden"  HorizontalAlignment="Left"  VerticalAlignment="Top"  Cursor="Hand"
                   MouseLeave="Save_Menu_Close" >
                    <MenuItem >
                        <MenuItem.Header>
                            <DockPanel>
                                <Label MouseDown="SaveChartImage">Save current chart</Label>
                            </DockPanel>
                        </MenuItem.Header>
                    </MenuItem>
                    
                </Menu>
                <Menu  Name="AbortMenu"  Visibility="Hidden"  HorizontalAlignment="Left"  VerticalAlignment="Top"  Cursor="Hand"
                   MouseLeave="Abort_Menu_Close" >
                    <MenuItem >
                        <MenuItem.Header>
                            <DockPanel>
                                <Label MouseDown="Button_Click_Abort" Name="AbortMenuItem" IsEnabled="False">After current cluster</Label>
                            </DockPanel>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem >
                        <MenuItem.Header>
                            <DockPanel>
                                <Label IsEnabled="False">Immediately</Label>
                            </DockPanel>
                        </MenuItem.Header>
                    </MenuItem>
                </Menu>
                <Menu  Name="HelpMenu"  Visibility="Hidden"  HorizontalAlignment="Left"  VerticalAlignment="Top"  Cursor="Hand"
                   MouseLeave="Help_Menu_Close" >
                    <MenuItem >
                        <MenuItem.Header>
                            <DockPanel>
                                <Label MouseDown="ShowHelpInput">Parameters</Label>
                            </DockPanel>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem >
                        <MenuItem.Header>
                            <DockPanel>
                                <Label MouseDown="ShowHelpOutput">Output file formats</Label>
                            </DockPanel>
                        </MenuItem.Header>

                    </MenuItem>
                    <MenuItem >
                        <MenuItem.Header>
                            <DockPanel>
                                <Label MouseDown="ShowHelpAbout">About</Label>
                            </DockPanel>
                        </MenuItem.Header>

                    </MenuItem>
                </Menu>
            </Grid>
        </DockPanel>

        <!--RHS drop-down progress menu-->
        <DockPanel DockPanel.Dock="Top" Panel.ZIndex="100">
            <StackPanel Height="400" DockPanel.Dock="Left" VerticalAlignment="Top" Orientation="Vertical"/><!--Panel assists with layout-->
            <StackPanel Name="StatsPanel" Orientation="Vertical" VerticalAlignment="Top" Margin="5,-25" DockPanel.Dock="right"  
                   Height="auto" Width="150" HorizontalAlignment="Right">
                <!--Stats menu section one-->
                <Expander x:Name="OverviewFileStats" Header="DETECTED SO FAR" FontSize="10" IsExpanded="False" Cursor="Hand"
                            ExpandDirection="Down" Grid.ColumnSpan="2" Width="auto">
                    <Border BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" BorderThickness="1,0,1,1">
                        <Grid HorizontalAlignment="Right" >
                            <Grid.RowDefinitions>
                                <RowDefinition  />
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="40" />
                            </Grid.ColumnDefinitions>
                            <Border Background="White" Grid.ColumnSpan="2" Grid.RowSpan="3" Opacity="0.7" Margin="-10,0,10,0" />
                            <Label FontSize="12" Name="SamplesDisplayLabel" Grid.Row="0" Grid.Column="0" >Indiv detected:</Label>
                            <Label Name="SamplesDisplay" Grid.Row="0" Grid.Column="1" HorizontalAlignment="Right" FontSize="12" />
                            <Label FontSize="12" Grid.Row="1" Grid.Column="0">Max align qual:</Label>
                            <Label Name="MAPQdisplay" Grid.Row="1" Grid.Column="1" HorizontalAlignment="Right" FontSize="12"/>
                            <Label FontSize="12" Grid.Row="2" Grid.Column="0">Max read qual:</Label>
                            <Label Name="READQdisplay" Grid.Row="2" Grid.Column="1" HorizontalAlignment="Right" FontSize="12"/>
                        </Grid>
                    </Border>
                </Expander>
                
                <!--Stats menu section two-->
                <Expander x:Name="OverviewAllClustersStats" Header="ALL CLUSTERS" FontSize="10" IsExpanded="False" Cursor="Hand"
                            ExpandDirection="Down" Grid.ColumnSpan="2" Width="auto" >
                    <Border BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"  BorderThickness="1,0,1,1">
                        <Grid HorizontalAlignment="Right" >

                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="40" />
                            </Grid.ColumnDefinitions>
                            <Border Background="White" Grid.ColumnSpan="2" Grid.RowSpan="4" Opacity="0.7" Margin="-10,0,10,0"></Border>

                            <Label FontSize="12" Grid.Row="0" Grid.Column="0">Avg dirt:</Label>
                            <Label Name="DirtDisplay" Grid.Row="0" Grid.Column="1" HorizontalAlignment="Right" FontSize="12"></Label>

                            <Label FontSize="12" Grid.Row="1" Grid.Column="0">Avg align qual:</Label>
                            <Label Name="AvgMAPQDisplay" Grid.Row="1" Grid.Column="1" HorizontalAlignment="Right" FontSize="12"></Label>

                            <Label FontSize="12" Grid.Row="2" Grid.Column="0">Avg read qual:</Label>
                            <Label Name="AvgREADQDisplay" Grid.Row="2" Grid.Column="1" HorizontalAlignment="Right" FontSize="12"></Label>
                            <ProgressBar Name="GoodBadProgressBar" Minimum="0" Maximum="100"  Height="15"
                                     Margin="2" Grid.Row="3" Grid.ColumnSpan="2" />
                            <Label Name="GoodCountLabel" Width="auto" HorizontalAlignment="Left" Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" FontSize="9">Good</Label>
                            <Label Name="BadCountLabel" Width="auto" Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" HorizontalAlignment="Right" FontSize="9">Bad</Label>

                        </Grid>
                    </Border>
                </Expander>

                <!--Stats menu section three-->
                <Expander x:Name="OverviewGoodClustersStats" Header="GOOD CLUSTERS" FontSize="10" IsExpanded="False" Cursor="Hand"
                            ExpandDirection="Down" Grid.ColumnSpan="2" Width="auto"
                          ToolTip="These will be the averages for your filtered BAM output file">
                    <Border BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"  BorderThickness="1,0,1,1">
                        <Grid HorizontalAlignment="Right" >
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="40" />
                            </Grid.ColumnDefinitions>
                            <Border Background="White" Grid.ColumnSpan="2" Grid.RowSpan="3" Opacity="0.7" Margin="-10,0,10,0"></Border>

                            <Label FontSize="12" Grid.Row="0" Grid.Column="0">Avg dirt:</Label>
                            <Label Name="DirtDisplayGood" Grid.Row="0" Grid.Column="1" HorizontalAlignment="Right" FontSize="12"></Label>

                            <Label FontSize="12" Grid.Row="1" Grid.Column="0">Avg align qual:</Label>
                            <Label Name="AvgMAPQDisplayGood" Grid.Row="1" Grid.Column="1" HorizontalAlignment="Right" FontSize="12"></Label>

                            <Label FontSize="12" Grid.Row="2" Grid.Column="0">Avg read qual:</Label>
                            <Label Name="AvgREADQDisplayGood" Grid.Row="2" Grid.Column="1" HorizontalAlignment="Right" FontSize="12"></Label>

                        </Grid>
                    </Border>
                </Expander>
            </StackPanel>
        </DockPanel>


        <!--Bottom of page status bar (abort button and progress bar)-->
        <StatusBar x:Name="StatusBar" DockPanel.Dock="Bottom" Height="50" Background="{DynamicResource {x:Static SystemColors.MenuBrushKey}}">

            <!--Abort button-->
            <Button Name="AbortButton" Content="X" ToolTip="Finish parsing the current file" Margin="10,0,0,0" Cursor="Hand"
                     Height="20" Width="20" Click="Button_Click_Abort" Visibility="Hidden" FontWeight="Bold" 
                    Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" FontFamily="Tahoma"/>

            <!--Progress bar-->
            <StatusBarItem Name="ProgressStatusBar" HorizontalContentAlignment="Stretch" Visibility="Visible">
                <Grid>
                    <ProgressBar x:Name="ProgressBar"  HorizontalAlignment="Stretch" IsEnabled="True" Height="20"
                         Visibility="Hidden" Margin="10" HorizontalContentAlignment="Stretch" VerticalAlignment="Center"
                                 Grid.Column="0" Grid.Row="0" 
                             ScrollViewer.VerticalScrollBarVisibility="Disabled" />
                    <Label Name="LoadingBarLabel" Grid.Column="0" Grid.Row="0" VerticalAlignment="Center" 
                           FontSize="10" HorizontalAlignment="Center" Visibility="Hidden"/>
                </Grid>
            </StatusBarItem>

        </StatusBar>

        <!--Bottom of page status message panel-->
        <DockPanel DockPanel.Dock="Bottom" Height="25" >
            <Label Name="AbortingMessage" Visibility="Hidden"  HorizontalAlignment="Center" 
                   Foreground="{DynamicResource {x:Static SystemColors.HotTrackBrushKey}}" 
               >Ploidulation will abort after the current cluster is processed.</Label>
            <Label Name="TimerLabel"  DockPanel.Dock="Right" Width="auto" HorizontalAlignment="Right" Visibility="Hidden"/>
        </DockPanel>

        <!--Main panel-->
        <Grid x:Name="MainPanel" Margin="25,-370,25,0"  Height="auto" >
            <TabControl Width="auto" >
                
                <!--Menu options tab-->
                <TabItem Name="Tab0" Header="Menu" IsSelected="True" Cursor="Hand">

                    <ScrollViewer HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Auto">
                        <WrapPanel ScrollViewer.CanContentScroll="True" Margin="10" Orientation="Vertical" >

                            <!--Input file menu-->
                            <Expander x:Name="FileExpander" Header="INPUT FILE AND PARAMETERS" Margin="0" IsExpanded="True" Cursor="Hand"
                                ExpandDirection="Down" Grid.ColumnSpan="2" Width="auto" >
                                <Border  BorderThickness="0,0,0,2" Padding="5" Margin="15,0,0,15"
                                         BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" >

                                    <Grid >
                                        <Grid.RowDefinitions>
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition  />
                                            <RowDefinition  />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120" />
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="100" />
                                        </Grid.ColumnDefinitions>

                                        <Label Content="File:"  Grid.Row="0" Grid.Column="0" ToolTip="Input file (in BAM format)"/>

                                        <Button x:Name="DataFileAButton" Content="Browse" Click="Button_Click_GetFile" 
                                            HorizontalAlignment="Right" Width="50"  Height="22" Grid.Row="0" Grid.Column="3" />

                                        <TextBox x:Name="DataFileATextbox" 
                                            TextWrapping="Wrap" HorizontalAlignment="Left" Margin="0,2"
                                            Width="245" Height="22" ToolTip="Input file (in BAM format)"
                                            Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="3">C:\Users\Nigel\SkyDrive\Ploidy\final-all_bam-merged.bam</TextBox>

                                        <Label Content="Ploidy:" ToolTip="Usual ploidy level of the organism under study" 
                                               Grid.Row="1"  />

                                        <ComboBox x:Name="ExpectedPloidyTextbox" ToolTip="Usual ploidy level of the organism under study"
                                            VerticalAlignment="Center" Margin="0,2" Height="auto"  Grid.RowSpan="1"
                                            Grid.Column="1" Grid.Row="1" SelectedIndex="1" IsDropDownOpen="False" SelectionChanged="ExpectedPloidyTextbox_SelectionChanged">
                                            <ListBoxItem Content="1"/>
                                            <ListBoxItem Content="2"/>
                                            <ListBoxItem Content="3"/>
                                            <ListBoxItem Content="4"/>
                                            <ListBoxItem Content="5"/>
                                            <ListBoxItem Content="6"/>
                                        </ComboBox>
                                        <Separator Grid.ColumnSpan="4" Grid.Row="2" Margin="5"></Separator>

                                        <Label Content="Alignment qual min:" Grid.Row="3"  Grid.Column="0">
                                            <Label.ToolTip>
                                                <TextBlock>  
                                                      BAM MAPQ. The higher the better. Clusters with an average read alignment 
                                                      <LineBreak/>
                                                     quality below this value will be excluded. Min should be set to at least 10.
                                                </TextBlock>
                                            </Label.ToolTip>
                                        </Label>
                                        <TextBox x:Name="AlignmentQualCutoffTextbox" Text="20"  Margin="0,2"
                                        Grid.Column="1" Grid.Row="3" TextChanged="NumericOnly_TextChanged" >
                                            <TextBox.ToolTip>
                                                <TextBlock>  
                                                      BAM MAPQ. The higher the better. Clusters with an average read alignment 
                                                      <LineBreak/>
                                                     quality below this value will be excluded. Min should be set to at least 10.
                                                </TextBlock>
                                            </TextBox.ToolTip>
                                        </TextBox>

                                        <Label Content="Read qual min:" Grid.Row="4" Grid.Column="0" ToolTip="Phred quality score from 0 to 93 (per-read average)"  />

                                        <ComboBox x:Name="ReadQualCutoffTextbox" ToolTip="Phred quality score from 0 to 93 (per-read average)" 
                                            VerticalAlignment="Center" Margin="0,2" Height="auto"  Grid.RowSpan="1"
                                            Grid.Column="1" Grid.Row="4" SelectedIndex="2" IsDropDownOpen="False">
                                            <ListBoxItem Content="0"/>
                                            <ListBoxItem Content="5"/>
                                            <ListBoxItem Content="10"/>
                                            <ListBoxItem Content="15"/>
                                            <ListBoxItem Content="20"/>
                                            <ListBoxItem Content="30"/>
                                            <ListBoxItem Content="40"/>
                                            <ListBoxItem Content="50"/>
                                            <ListBoxItem Content="60"/>
                                            <ListBoxItem Content="70"/>
                                            <ListBoxItem Content="80"/>
                                            <ListBoxItem Content="90"/>
                                        </ComboBox>

                                        <Label Content="Population size:*" ToolTip="Total number of individuals sampled in the input dataset"
                                            Grid.Row="1" Grid.Column="2" />
                                        <TextBox x:Name="NumSamplesTextbox" Text="48" ToolTip="Total number of individuals sampled in the input dataset"
                                            Margin="0,2" TextChanged="NumericOnly_TextChanged" Grid.Column="3" Grid.Row="1" />

                                        <Label Content="Dirt max:" 
                                            Grid.Row="4" Grid.Column="2">
                                            <Label.ToolTip>
                                                <TextBlock>  
                                                    Cluster ‘dirt’ represents the fraction of distinct sequences within a cluster which <LineBreak/>
                                                    are outside the ploidy of the organism (i.e. for diploid, the fraction of sequences <LineBreak/>
                                                    which are outside the top two most highly represented sequences for each individual). <LineBreak/>
                                                    The default value is 0.1 (10%). Clusters with a 'dirt' score greater than this value <LineBreak/>
                                                    will be categorised as ‘bad’.
                                                </TextBlock>
                                            </Label.ToolTip>
                                            
                                        </Label>
                                        <ComboBox x:Name="DirtCutoffTextbox" 
                                            VerticalAlignment="Center" Margin="0,2" Height="auto"  Grid.RowSpan="1"
                                            Grid.Column="3" Grid.Row="4" SelectedIndex="9" IsDropDownOpen="False">
                                            <ListBoxItem Content="0.01"/>
                                            <ListBoxItem Content="0.02"/>
                                            <ListBoxItem Content="0.03"/>
                                            <ListBoxItem Content="0.04"/>
                                            <ListBoxItem Content="0.05"/>
                                            <ListBoxItem Content="0.06"/>
                                            <ListBoxItem Content="0.07"/>
                                            <ListBoxItem Content="0.08"/>
                                            <ListBoxItem Content="0.09"/>
                                            <ListBoxItem Content="0.1"/>
                                            <ListBoxItem Content="0.2"/>
                                            <ListBoxItem Content="0.3"/>
                                            <ListBoxItem Content="0.4"/>
                                            <ListBoxItem Content="0.5"/>
                                            <ListBoxItem Content="0.6"/>
                                            <ListBoxItem Content="0.7"/>
                                            <ListBoxItem Content="0.8"/>
                                            <ListBoxItem Content="0.9"/>
                                            <ListBoxItem Content="1" ToolTip="All"/>
                                            <ComboBox.ToolTip>
                                                <TextBlock>  
                                                    Cluster ‘dirt’ represents the fraction of distinct sequences within a cluster which <LineBreak/>
                                                    are outside the ploidy of the organism (i.e. for diploid, the fraction of sequences <LineBreak/>
                                                    which are outside the top two most highly represented sequences for each individual). <LineBreak/>
                                                    The default value is 0.1 (10%). Clusters with a 'dirt' score greater than this value <LineBreak/>
                                                    will be categorised as ‘bad’.
                                                </TextBlock>
                                            </ComboBox.ToolTip>
                                        </ComboBox>

                                        <Label Content="Ploidy dis. max:" 
                                            Grid.Row="5" Grid.Column="2">
                                            <Label.ToolTip>
                                                <TextBlock>  
                                                      The ploidy disagreement score represents the fraction of distinct sequences which <LineBreak/>
                                                      are both in-ploidy for some individuals in a cluster and out-of-ploidy for other <LineBreak/>
                                                      individuals. The default value is set at 0.02, with a lower value indicating that <LineBreak/>
                                                      there is a greater consensus between the individuals as to which distinct sequences are most <LineBreak/>
                                                      highly represented.
                                                </TextBlock>
                                            </Label.ToolTip>
                                            
                                        </Label>
                                        <ComboBox x:Name="PloidyDisagreementTextbox" 
                                            VerticalAlignment="Center" Margin="0,2" Height="auto"  Grid.RowSpan="1"
                                            Grid.Column="3" Grid.Row="5" SelectedIndex="2" IsDropDownOpen="False">
                                            <ListBoxItem Content="0"/>
                                            <ListBoxItem Content="0.01"/>
                                            <ListBoxItem Content="0.02"/>
                                            <ListBoxItem Content="0.03"/>
                                            <ListBoxItem Content="0.04"/>
                                            <ListBoxItem Content="0.05"/>
                                            <ListBoxItem Content="0.06"/>
                                            <ListBoxItem Content="0.07"/>
                                            <ListBoxItem Content="0.08"/>
                                            <ListBoxItem Content="0.09"/>
                                            <ListBoxItem Content="0.1"/>
                                            <ListBoxItem Content="0.15"/>
                                            <ListBoxItem Content="0.2"/>
                                            
                                            <ListBoxItem Content="1" ToolTip="All"/>
                                            <ComboBox.ToolTip>
                                                <TextBlock>  
                                                      The ploidy disagreement score represents the fraction of distinct sequences which <LineBreak/>
                                                      are both in-ploidy for some individuals in a cluster and out-of-ploidy for other <LineBreak/>
                                                      individuals. The default value is set at 0.02, with a lower value indicating that <LineBreak/>
                                                      there is a greater consensus between the individuals as to which distinct sequences are most <LineBreak/>
                                                      highly represented.
                                                </TextBlock>
                                            </ComboBox.ToolTip>
                                        </ComboBox>

                                        <Label Grid.Row="3" Grid.Column="2" ToolTip="Minimum percentage of sampled population that should be represented in each cluster">Population min:</Label>
                                        <ComboBox x:Name="PopPercentTextbox" ToolTip="Minimum percentage of sampled population that should be represented in each cluster" 
                                            VerticalAlignment="Center" Margin="0,2" Height="auto"  Grid.RowSpan="1"
                                            Grid.Column="3" Grid.Row="3" SelectedIndex="3" IsDropDownOpen="False">
                                            <ListBoxItem Content="0" ToolTip="Any number of sampled individuals may be present in each cluster"/>
                                            <ListBoxItem Content="0.1"/>
                                            <ListBoxItem Content="0.2"/>
                                            <ListBoxItem Content="0.3"/>
                                            <ListBoxItem Content="0.4"/>
                                            <ListBoxItem Content="0.5"/>
                                            <ListBoxItem Content="0.6"/>
                                            <ListBoxItem Content="0.7"/>
                                            <ListBoxItem Content="0.8"/>
                                            <ListBoxItem Content="0.9"/>
                                            <ListBoxItem Content="1" ToolTip="All sampled individuals must be present in every cluster"/>
                                        </ComboBox>

                                        <Label Content="Haplotypes max:" Grid.Row="5"  Grid.Column="0">
                                            <Label.ToolTip>
                                                <TextBlock>  
                                                      Diploid only: Maximum number of haplotypes that should be represented in each cluster
                                                      <LineBreak/>
                                                     (where 3 is standard for a diploid organism, but a higher value may be used for error tolerance)
                                                </TextBlock>
                                            </Label.ToolTip>
                                        </Label>
                                        <TextBox x:Name="MaxHaplotypesTextbox" Text="4" Margin="0,2"
                                        Grid.Column="1" Grid.Row="5" TextChanged="NumericOnly_TextChanged" >
                                            <TextBox.ToolTip>
                                                <TextBlock>  
                                                      Diploid only: Maximum number of haplotypes that should be represented in each cluster
                                                      <LineBreak/>
                                                     (where 3 is standard for a diploid organism, but a higher value may be used for error tolerance)
                                                </TextBlock>
                                            </TextBox.ToolTip>
                                        </TextBox>

                                        <Label Content="Only haplotype 'good' clusters:" MouseDown="Label_MouseDown_7"
                                               Grid.Row="6" Grid.ColumnSpan="2"  Grid.Column="0">
                                            <Label.ToolTip>
                                                <TextBlock>  
                                                      Diploid only: The process of calculating haplotypes for each cluster can be slow. 
                                                      <LineBreak/>
                                                     Parsing of file can be sped up by only calclating haplotypes for clusters 
                                                    <LineBreak/>
                                                    which are 'good' based on all other criteria. If haplotypes are above the 
                                                    <LineBreak/>
                                                    maximum indicated above, the cluster will be reclassified as 'bad'.
                                                </TextBlock>
                                            </Label.ToolTip>
                                        </Label>
                                        <CheckBox Name="OnlyHaplotypeGood" IsChecked="True"
                                            Grid.Row="6" Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center"></CheckBox>
                                        
                                        <Button x:Name="LaunchButton" Content="Go" ToolTip="Go forth and ploidulate" HorizontalAlignment="Right" 
                                            Width="48"  Click="Button_Click_Go" Height="22" Grid.Row="6" Grid.Column="3"/>
                                    </Grid>

                                </Border>
                            </Expander>

                            <!--Output file menu-->
                            <Expander x:Name="OutputFileExpander" Header="OUTPUT FILES" Margin="0" IsExpanded="False" Cursor="Hand"
                                ExpandDirection="Down" Grid.ColumnSpan="2" Width="auto">
                                <Border  BorderThickness="0,0,0,2" Padding="5" Margin="15,0,0,15"
                                         BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" >

                                    <Grid >
                                        <Grid.RowDefinitions>
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition  />
                                            <RowDefinition  />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120" />
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="100" />
                                        </Grid.ColumnDefinitions>

                                        <Label Content="Per-cluster metrics from original BAM file (.metr)" 
                                            Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" 
                                            ToolTip="Generate output file with metric data for the input data file" MouseDown="Label_MouseDown_4"/>
                                        <CheckBox x:Name="MetricFileParent" IsChecked="True" 
                                            ToolTip="Generate output file with metric data for the input data file"
                                            VerticalAlignment="Center"  HorizontalAlignment="Right" Grid.Row="0" Grid.Column="3" />

                                        <Label Content="Per-cluster metrics from filtered 'good' clusters (.metr)" 
                                            Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" 
                                            ToolTip="Generate output file with metric data for the filtered 'good' clusters" MouseDown="Label_MouseDown_3"/>
                                        <CheckBox x:Name="MetricFileChild" IsChecked="True" ToolTip="Generate output file with metric data for the filtered 'good' clusters"
                                          VerticalAlignment="Center"  HorizontalAlignment="Right" Grid.Row="1" Grid.Column="3" />

                                        <Label Content="Overview (across-cluster) metrics for original BAM file" 
                                            Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" MouseDown="Label_MouseDown_2"
                                            ToolTip="Generate output file with overview metric data for the input data file"/>
                                        <CheckBox x:Name="OutputOverviewParent" IsChecked="True" ToolTip="Generate output file with overview metric data for the input data file"
                                            VerticalAlignment="Center"  HorizontalAlignment="Right" Grid.Row="3" Grid.Column="3" />

                                        <Label Content="Overview (across-cluster) metrics for filtered 'good' clusters" 
                                            Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="4" MouseDown="Label_MouseDown_1"
                                            ToolTip="Generate output file with overview metric data for the filtered 'good' clusters"/>
                                        <CheckBox x:Name="OutputOverviewChild" IsChecked="True" ToolTip="Generate output file with overview metric data for the filtered 'good' clusters"
                                            VerticalAlignment="Center"  HorizontalAlignment="Right" Grid.Row="4" Grid.Column="3" />

                                        <Label Content="New filtered BAM file containing 'good' clusters" 
                                            Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="3" 
                                            ToolTip="Outputs 'good' reads directly to another BAM file based on filter criteria"  
                                               MouseDown="Label_MouseDown"/>
                                        <CheckBox x:Name="OutputToFile" IsChecked="True" ToolTip="Outputs 'good' reads directly to another BAM file based on filter criteria"
                                            VerticalAlignment="Center"  HorizontalAlignment="Right" Grid.Row="5" Grid.Column="3" />

                                        <Label Content="Genotypes" ToolTip="Diploid only: write genotypes to file"
                                            Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="3" 
                                            MouseDown="Label_MouseDown_5"/>
                                        <CheckBox x:Name="GenotypesToFile" IsChecked="False" ToolTip="Diploid only: write genotypes to file"
                                            VerticalAlignment="Center"  HorizontalAlignment="Right" Grid.Row="6" Grid.Column="3" />

                                        <Label Content="Haplotypes" ToolTip="Diploid only: write haplotypes to file"
                                            Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="3" 
                                             MouseDown="Label_MouseDown_6"/>
                                        <CheckBox x:Name="HaplotypesToFile" IsChecked="False" ToolTip="Diploid only: write haplotypes to file"
                                            VerticalAlignment="Center"  HorizontalAlignment="Right" Grid.Row="7" Grid.Column="3" />
                                    </Grid>
                                </Border>
                            </Expander>

                        </WrapPanel>
                    </ScrollViewer>
                </TabItem>

                <!--Ploidy piechart tab-->
                <TabItem Name="Tab1" Header="Ploidy" GotFocus="UpdatePiechartDisplay" IsEnabled="False" Cursor="Hand">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="20" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition  />
                            <ColumnDefinition  />
                        </Grid.ColumnDefinitions>
                        

                        <Label Width="auto" HorizontalAlignment="Center" Margin="10" FontSize="14" Grid.ColumnSpan="2">Ploidy distribution</Label>

                        <!--Note that for two charts, all styling is duplicated via copy-paste. TODO: handle this properly-->

                        <!--Piechart: original input file (in/out of ploidy distribution)-->
                        <charting:Chart  Name="PloidyPie" Title="All clusters" Margin="10,10,10,10" BorderBrush="{x:Null}"
		                    Grid.RowSpan="1" Grid.ColumnSpan="1" Grid.Row="0" Grid.Column="0" >

                            <!--Data series style-->
                            <charting:PieSeries DependentValuePath="Value" IndependentValuePath="Key" ItemsSource="{Binding}" >
                                <!--Define style and colour for two (2) pie chart slices (dark grey and light grey)-->
                                <charting:PieSeries.Palette>
                                    <visualisation:ResourceDictionaryCollection>
                                        <ResourceDictionary>
                                            <Style x:Key="DataPointStyle" TargetType="Control">
                                                <Setter Property="Template" Value="{StaticResource PieDataTemplate}" />
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <!--Dark-->
                                                        <RadialGradientBrush>
                                                            <RadialGradientBrush.RelativeTransform>
                                                                <TransformGroup>
                                                                    <ScaleTransform CenterX="0.5" CenterY="0.5" ScaleX="2.09" ScaleY="1.819"/>
                                                                    <TranslateTransform X="-0.425" Y="-0.486"/>
                                                                </TransformGroup>
                                                            </RadialGradientBrush.RelativeTransform>
                                                            <GradientStop Color="#FF615F59"/>
                                                            <GradientStop Color="#FF272725" Offset="1"/>
                                                        </RadialGradientBrush>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ResourceDictionary>
                                        <ResourceDictionary>
                                            <Style x:Key="DataPointStyle" TargetType="Control">
                                                <Setter Property="Template" Value="{StaticResource PieDataTemplate}" />
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <!--Light-->
                                                        <RadialGradientBrush>
                                                            <RadialGradientBrush.RelativeTransform>
                                                                <TransformGroup>
                                                                    <ScaleTransform CenterX="0.5" CenterY="0.5" ScaleX="2.09" ScaleY="1.819"/>
                                                                    <TranslateTransform X="-0.425" Y="-0.486"/>
                                                                </TransformGroup>
                                                            </RadialGradientBrush.RelativeTransform>
                                                            <GradientStop Color="#FFDAD7D7"/>
                                                            <GradientStop Color="#FFA4A3A3" Offset="1"/>
                                                        </RadialGradientBrush>
                                                    </Setter.Value>
                                                </Setter>


                                            </Style>
                                        </ResourceDictionary>

                                    </visualisation:ResourceDictionaryCollection>
                                </charting:PieSeries.Palette>
                            </charting:PieSeries>

                            <!--Plot area style-->
                            <charting:Chart.PlotAreaStyle>
                                <Style TargetType="Grid" >
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Width" Value="auto" />
                                </Style>
                            </charting:Chart.PlotAreaStyle>

                            <!--Style template for chart-->
                            <charting:Chart.Style>
                                <Style TargetType="charting:Chart">
                                    <Setter Property="Template" Value="{StaticResource PieLayoutTemplate}" />
                                </Style>
                            </charting:Chart.Style>
                        </charting:Chart>

                        <!--Piechart: filtered output file (in/out of ploidy distribution)-->
                        <charting:Chart  Name="PloidyPieGood" Title="Good clusters" Margin="10,10,10,10" BorderBrush="{x:Null}"
		                    Grid.RowSpan="1" Grid.ColumnSpan="1" Grid.Row="0" Grid.Column="1" Visibility="Hidden">

                            <!--Data series style-->
                            <charting:PieSeries DependentValuePath="Value" IndependentValuePath="Key" ItemsSource="{Binding}" >
                                <!--Define style and colour for two (2) pie chart slices (dark grey and light grey)-->
                                <charting:PieSeries.Palette>
                                    <visualisation:ResourceDictionaryCollection>
                                        <ResourceDictionary>
                                            <Style x:Key="DataPointStyle" TargetType="Control">
                                                <Setter Property="Template" Value="{StaticResource PieDataTemplate}" />
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <!--Dark-->
                                                        <RadialGradientBrush>
                                                            <RadialGradientBrush.RelativeTransform>
                                                                <TransformGroup>
                                                                    <ScaleTransform CenterX="0.5" CenterY="0.5" ScaleX="2.09" ScaleY="1.819"/>
                                                                    <TranslateTransform X="-0.425" Y="-0.486"/>
                                                                </TransformGroup>
                                                            </RadialGradientBrush.RelativeTransform>
                                                            <GradientStop Color="#FF615F59"/>
                                                            <GradientStop Color="#FF272725" Offset="1"/>
                                                        </RadialGradientBrush>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ResourceDictionary>
                                        <ResourceDictionary>
                                            <Style x:Key="DataPointStyle" TargetType="Control">
                                                <Setter Property="Template" Value="{StaticResource PieDataTemplate}" />
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <!--Light-->
                                                        <RadialGradientBrush>
                                                            <RadialGradientBrush.RelativeTransform>
                                                                <TransformGroup>
                                                                    <ScaleTransform CenterX="0.5" CenterY="0.5" ScaleX="2.09" ScaleY="1.819"/>
                                                                    <TranslateTransform X="-0.425" Y="-0.486"/>
                                                                </TransformGroup>
                                                            </RadialGradientBrush.RelativeTransform>
                                                            <GradientStop Color="#FFDAD7D7"/>
                                                            <GradientStop Color="#FFA4A3A3" Offset="1"/>
                                                        </RadialGradientBrush>
                                                    </Setter.Value>
                                                </Setter>


                                            </Style>
                                        </ResourceDictionary>

                                    </visualisation:ResourceDictionaryCollection>
                                </charting:PieSeries.Palette>
                            </charting:PieSeries>

                            <!--Plot area style-->
                            <charting:Chart.PlotAreaStyle>
                                <Style TargetType="Grid" >
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Width" Value="auto" />
                                </Style>
                            </charting:Chart.PlotAreaStyle>

                            <!--Style template for chart-->
                            <charting:Chart.Style>
                                <Style TargetType="charting:Chart">
                                    <Setter Property="Template" Value="{StaticResource PieLayoutTemplate}" />
                                </Style>
                            </charting:Chart.Style>
                        </charting:Chart>

                    </Grid>
                </TabItem>

                <!--Columnchart tab-->
                <TabItem Name="Tab2" Header="Read count" GotFocus="UpdateColumnchartDisplay" IsEnabled="False" Cursor="Hand">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="20" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                            <!--Additional controls for columnchart (slider and rounding selector)-->
                        <Grid Grid.Row="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Slider Name="SliderA" ValueChanged="SliderA_ValueChanged" VerticalAlignment="Center" Cursor="Hand"
                                    Value="{Binding SliderPosition, Mode=TwoWay}" Grid.Column="1" />
                            <Slider Name="SliderB" ValueChanged="SliderB_ValueChanged" VerticalAlignment="Center" Cursor="Hand"
                                    Value="{Binding SliderPosition, Mode=TwoWay}" Grid.Column="2" />
                            <!--<Button Content="Refresh" Click="UpdateColumnchartDisplay" 
                                    HorizontalAlignment="Right" Grid.Column="0" />-->
                            <ComboBox x:Name="ReadCountRounding" Margin="5,0,5,0" Height="20" Cursor="Hand"
                                ToolTip="Round read count to nearest [n]" SelectedIndex="1" IsDropDownOpen="False"  >
                                <ListBoxItem Content="1" MouseDown="UpdateColumnchartDisplay" />
                                <ListBoxItem Content="10" MouseDown="UpdateColumnchartDisplay"/>
                                <ListBoxItem Content="100" MouseDown="UpdateColumnchartDisplay"/>
                            </ComboBox>
                        </Grid>

                        <!--Tab/chart heading-->
                        <Label  Width="auto" HorizontalAlignment="Center" VerticalAlignment="Top" Grid.Row="0"
                                Margin="10" FontSize="14">Distinct read count distribution</Label>

                            <!--Read count chart-->
                            <charting:Chart Name="ReadCountChart"  Title="Distinct read count distribution"
                                        Margin="10,10,10,10" 
                                        BorderBrush="Transparent" Grid.ColumnSpan="1" Grid.Column="0" Grid.Row="1">

                                <charting:ColumnSeries DependentValuePath="Value" IndependentValuePath="Key" 
                                                       TransitionDuration="1"
                                                       ItemsSource="{Binding}" Title="All clusters" Background="Gray">

                                    <charting:ColumnSeries.DataPointStyle >
                                        <Style TargetType="charting:ColumnDataPoint">
                                            <Setter Property="Template" Value="{StaticResource ColumnDataTemplateA}" />
                                            <Setter Property="Background" Value="Gray"/>
                                        </Style>
                                    </charting:ColumnSeries.DataPointStyle>
                                </charting:ColumnSeries>

                                <charting:ColumnSeries DependentValuePath="Value" IndependentValuePath="Key" 
                                                       ItemsSource="{Binding}" Title="Good clusters" Background="#FFDED6D6">
                                    <charting:ColumnSeries.DataPointStyle >
                                        <Style TargetType="charting:ColumnDataPoint">
                                            <Setter Property="Template" Value="{StaticResource ColumnDataTemplateB}" />
                                            <Setter Property="Background" Value="#FFDED6D6"/>
                                        </Style>
                                    </charting:ColumnSeries.DataPointStyle>
                                </charting:ColumnSeries>

                            <!--<charting:LineSeries DependentValuePath="Value" IndependentValuePath="Key" ItemsSource="{Binding}" Title="Poisson curve"/>-->

                            <charting:Chart.Axes>
                                <charting:LinearAxis Name="ReadCountY" Orientation="Y"  Title="% Clusters (so far)" Minimum="0" 
                                                         BorderBrush="Black" BorderThickness="0,0,2,0" />
                                <charting:LinearAxis Name="ReadCountX" Orientation="X"  Title="Num Reads (so far)" Minimum="0"  />
                            </charting:Chart.Axes>

                            <charting:Chart.Style>
                                <Style TargetType="charting:Chart">
                                    <Setter Property="Template" Value="{StaticResource ColumnLayoutTemplate}" />
                                </Style>
                            </charting:Chart.Style>
                            </charting:Chart>

                    </Grid>
                </TabItem>

                <!--Linechart tab-->
                <TabItem Name="Tab3" Header="Population coverage" GotFocus="UpdateLinechartDisplay" IsEnabled="False" Cursor="Hand">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition  />
                        </Grid.ColumnDefinitions>
                        
                        <!--<Button Content="Refresh" Click="UpdateLinechartDisplay" Grid.Row="2" HorizontalAlignment="Right" />-->
                        
                        <!--Tab/chart heading-->
                        <Label Width="auto" HorizontalAlignment="Center" Margin="10" FontSize="14">Sample population distribution</Label>

                        <!--Individual distribution line chart-->
                        <charting:Chart Name="IndivChart"   Margin="10,10,10,10"  Title="Sample population distribution"
                                        Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="1" Grid.RowSpan="1"
                                    BorderBrush="Transparent"  >

                            <charting:LineSeries Name="AllClusters" DependentValuePath="Value" 
		                    IndependentValuePath="Key" ItemsSource="{Binding}" 
                                                 Title="All clusters" Background="#FF002EFF" >
                                <charting:LineSeries.DataPointStyle >
                                    <Style TargetType="charting:LineDataPoint">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Setter Property="Background" Value="Gray"/>
                                        <Setter Property="Opacity" Value="0" />
                                    </Style>
                                </charting:LineSeries.DataPointStyle>
                            </charting:LineSeries>

                            <charting:LineSeries Name="GoodClusters" DependentValuePath="Value" 
		                    IndependentValuePath="Key" ItemsSource="{Binding}"  Title="Good clusters" Background="#FFDED6D6" >
                                <charting:LineSeries.DataPointStyle >
                                    <Style TargetType="charting:LineDataPoint">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Setter Property="Background" Value="#FFDED6D6"/>
                                        <Setter Property="Opacity" Value="0" />
                                    </Style>
                                </charting:LineSeries.DataPointStyle>
                            </charting:LineSeries>

                            <charting:Chart.Axes>
                                <charting:LinearAxis Name="IndividualsYAxis" Orientation="Y"  Title="% Clusters (so far)" Minimum="0"  />
                                <charting:CategoryAxis  Orientation="X"  Title="% Individuals"  SortOrder="Descending"  />
                            </charting:Chart.Axes>

                            <charting:Chart.Style>
                                <Style TargetType="charting:Chart">
                                    <Setter Property="Template" Value="{StaticResource ColumnLayoutTemplate}" />
                                </Style>
                            </charting:Chart.Style>

                        </charting:Chart>

                    </Grid>
                </TabItem>

                <!--Help/information tab-->
                <TabItem Name="Tab4" Header="About"  IsEnabled="True" Cursor="Hand">
                    <ScrollViewer Name="d" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Auto"  >
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" Name="c" />
                            </Grid.ColumnDefinitions>

                            <!--Help: input parameters-->
                            <Expander x:Name="AboutInputParameters" Header="INPUT FILE AND PARAMETERS" Margin="0" IsExpanded="False" 
                                ExpandDirection="Down" Grid.ColumnSpan="1"   HorizontalAlignment="Left" Cursor="Hand"
                                          Width="{Binding ActualWidth, ElementName=d}" MinWidth="200">
                                <Border  BorderThickness="0,0,0,2" Padding="5" Margin="15,0,0,15"
                                         BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" >

                                    <Grid >
                                        <Grid.RowDefinitions>
                                            <RowDefinition />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <WrapPanel Orientation="Vertical">
                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10">
                                                PLOIDY
                                                <LineBreak/>
                                                The usual ploidy level of the organism under study. The default value is 2 (for diploid). If the input file is not for a diploid organism a different ploidy level may be supplied for this parameter, however the full range of metrics will not be available (genotype and haplotype estimates will be excluded).
                                            </TextBlock>
                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10">
                                                POPULATION SIZE
                                                <LineBreak/>
                                                The total number of individuals sampled in the input dataset. This value is required in order to calculate population coverage across the clusters. This field is mandatory.
                                            </TextBlock>

                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10">
                                                POPULATION COVERAGE MINIMUM
                                                <LineBreak/>
                                                The minimum percentage of the sampled population that should be represented in each cluster. The default value is 0.3 (30%).
                                                <LineBreak/>
                                                Care should be taken when setting this parameter, as setting the minimum too high could result in excluding valid clusters or considering only those which do not have SNPs at cut sites. On the other hand, the larger the percentage of the population which is represented in each cluster, the more accurate the cluster’s haplotype estimate may be.
                                            </TextBlock>

                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10">
                                                ALIGNMENT QUALITY MINIMUM
                                                <LineBreak/>
                                                The minimum per-cluster average alignment quality, drawn from the alignment qualities of each distinct sequence in the cluster. The higher the value, the higher the alignment quality. Clusters with an average read alignment quality below this value will be excluded. The recommended value for this parameter will vary between organisms, depending on the variability of the population.
                                            </TextBlock>

                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10">
                                                READ QUALITY MINIMUM
                                                <LineBreak/>
                                                The minimum per-cluster average read quality, drawn from the average read qualities of each distinct sequence in the cluster. This is represented by a Phred quality score from 0 to 93. The default minimum is 10, with higher values indicating higher average read qualities.
                                            </TextBlock>

                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10">
                                                HAPLOTYPES MAXIMUM
                                                <LineBreak/>
                                                The maximum number of haplotypes that should be represented in each cluster (where 3 is standard within a diploid population, but a higher value may be supplied for error tolerance). Clusters for which greater than this number of haplotypes is detected will be categorised as ‘bad’.
                                            </TextBlock>

                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10">
                                                CHECKBOX OPTION to calculate haplotypes only for ‘good’ clusters
                                                <LineBreak/>
                                                The haplotyping algorithm implemented by PHASE is computationally intensive. Parsing of the input file can be sped up by only calculating haplotypes for clusters which are nominally 'good' based on all other filter criteria. After the number of haplotypes is calculated, the cluster will then be reclassified as 'bad' if the maximum number of allowable haplotypes was exceeded.
                                            </TextBlock>

                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10">
                                                DIRT MAXIMUM
                                                <LineBreak/>
                                                Cluster ‘dirt’ represents the fraction of distinct sequences within a cluster which are outside the ploidy of the organism (i.e. for diploid, the fraction of sequences which are outside the top two most highly represented sequences for each individual). The default value is 0.1 (10%). Clusters with a 'dirt' score greater than this value will be categorised as ‘bad’.
                                            </TextBlock>

                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10">
                                                PLOIDY DISAGREEMENT MAXIMUM
                                                <LineBreak/>
                                                The ploidy disagreement score represents the fraction of distinct sequences which are both in-ploidy for some individuals in a cluster and out-of-ploidy for other individuals. The default value is set at 0.02, with a lower value indicating that there is a greater consensus between the individuals as to which distinct sequences are most highly represented.
                                            </TextBlock>

                                        </WrapPanel>
                                        
                                        
                                    
                                    </Grid>
                                </Border>
                            </Expander>

                            <!--Help: output files-->
                            <Expander x:Name="AboutOutputFiles" Header="OUTPUT FILES" Margin="0" IsExpanded="False" Cursor="Hand"
                                      Width="{Binding ActualWidth, ElementName=d}" MinWidth="200" HorizontalAlignment="Left"
                                        ExpandDirection="Down"  Grid.Row="1"  >

                                <Border  BorderThickness="0,0,0,2" Padding="5" Margin="15,0,0,15"
                                         BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" >

                                    <Grid>
                                        <WrapPanel Orientation="Vertical">
                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10" >
                                            METRIC FILES (.metr)
                                                <LineBreak />
                                            Two metric files will be produced: orig.metr for the original input file and filtered.metr for the filtered output file of ‘good’ clusters. These files contain various per-cluster metrics, one line per cluster, as the following tab-separated values:
                                                    <LineBreak /><LineBreak />
                                                cluster_id:  unique cluster id <LineBreak /><LineBreak />
                                                count_all_reads: the total number of reads in this cluster <LineBreak /><LineBreak />
                                                count_distinct_reads: the number of distinct sequences in this cluster <LineBreak /><LineBreak />
                                                num_individuals: the number of individuals having at least one read in this cluster <LineBreak /><LineBreak />
                                                dirt: cluster ‘dirt’ score (proportion of reads outside the top [ploidy]) <LineBreak /><LineBreak />
                                                ploidy_disagreement: degree of consensus on the top [ploidy] sequences <LineBreak /><LineBreak />
                                                alignment_quality: average alignment quality for the cluster <LineBreak /><LineBreak />
                                                read_quality: average read quality for the cluster <LineBreak /><LineBreak />
                                                population_percentage: percentage of the population represented in this cluster <LineBreak /><LineBreak />
                                                avg_reads_per_indiv: the average number of reads per individual <LineBreak /><LineBreak />
                                                avg_reads_per_indiv_dist: the average number of distinct reads per individual <LineBreak /><LineBreak />
                                                num_haplotypes: the estimated number of population haplotypes for this cluster
                                            </TextBlock>
                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10" >
                                            FILTERED OUPUT FILE (.bam)
                                                <LineBreak />
                                            ‘Good’ clusters will be written out to a new BAM alignment file, filtered.bam, which is identical to the original file but contains only those clusters which were classified as ‘good’ based on the supplied filter parameters.
                                            </TextBlock>

                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10" >
                                            GENOTYPES AND HAPLOTYPES (genotypes.txt, haplotypes.txt)
                                                <LineBreak />
                                            Text files can also be created for both genotype and haplotype data, genotypes.txt and haplotypes.txt. These files are a concatenation of the input files submitted to PHASE for each cluster, or the output files generated by PHASE for each cluster. They are un-checked on the output file menu and are not be generated by default, as they may both be quite large in size.
                                            </TextBlock>

                                            <TextBlock TextWrapping="Wrap" Margin="0,10,20,10" >
                                            OVERVIEW (ACROSS-CLUSTER) METRICS (various .tsv files)
                                                <LineBreak />
                                            Two additional directories are created within the above output directory: orig and filtered. Each of these directories contains a set of .tsv files presenting various statistical overviews of either all clusters (orig) or good clusters (filtered). The files in each of these directories are as follows:
                                                <LineBreak /><LineBreak />
                                                read_counts_distinct.tsv<LineBreak />For each per-cluster distinct read count, the number of clusters that share the same distinct read count. This same data is used to generate the Read count chart.
                                                <LineBreak /><LineBreak />
                                                read_counts_all.tsv<LineBreak />For each per-cluster read count, the number of clusters that share the same read count.
                                                <LineBreak /><LineBreak />
                                                by_indiv_read_counts_distinct.tsv<LineBreak />For each per-individual per-cluster distinct read count, the number of clusters that share the same read count.
                                                <LineBreak /><LineBreak />
                                                by_indiv_read_counts.tsv<LineBreak />For each per-individual per-cluster read count, the number of clusters that share the same read count.
                                                <LineBreak /><LineBreak />
                                                frequencies.tsv<LineBreak />With one line for each cluster, gives the relative distribution of each distinct sequence, ordered from most to least frequently observed.
                                                <LineBreak /><LineBreak />
                                                individuals_distribution.tsv<LineBreak />For each (actual, unnormalised) number of individuals, the number of clusters in which that number of individuals are represented. This same data is used, converted to percentage data, to generate the Population coverage chart.
                                            </TextBlock>

                                        </WrapPanel>
                                        
                                        
                                    </Grid>
                                </Border>
                            </Expander>

                            <!--About: information-->
                            <Expander x:Name="AboutAbout" Header="ABOUT PLOIDULATOR" Margin="0" IsExpanded="False" Cursor="Hand"
                                ExpandDirection="Down" Grid.ColumnSpan="1" Grid.Row="2" Grid.Column="1" 
                                      Width="{Binding ActualWidth, ElementName=d}" MinWidth="200" HorizontalAlignment="Left">
                                <Border  BorderThickness="0,0,0,2" Padding="5" Margin="15,0,0,15"
                                         BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" >

                                    <Grid >
                                        <Grid.RowDefinitions>
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                        </Grid.RowDefinitions>
                                        <WrapPanel>

                                            <TextBlock TextWrapping="Wrap" Grid.Row="0" Margin="0,10,20,10">
                                                Ploidulator is a prototype cluster filtering and analysis tool. Using this tool, a BAM file containing aligned reads can be parsed, and user-defined parameters can be applied to determine which clusters are ‘good’. Good clusters are then written to a new filtered BAM file. Various metric statistics are also produced as text files, for both the original input file and the filtered ‘good’ output file, and this statistical data can be incorporated in future analyses of either the original or filtered files.

                                                <LineBreak/><LineBreak/>
                                                A variety of metrics are provided, and it is up to the user to determine which are suitable for their data set.
                                                
                                                <LineBreak/><LineBreak/>
                                        Ploidulator is implemented as a WPF application written in C#. The application is powered by .NET Bio, an open source bioinformatics library from Microsoft (2013) which provides a range of classes and algorithms for implementing bioinformatics applications.
                                        <LineBreak/><LineBreak/>
                                                Ploidulator is designed to operate on any personal computer running Windows, and does not require unusually high memory or processing power. The process of outputting results directly to file conserves memory usage and means that the filtered file is available for further analysis immediately after the analysis process has completed. For a ~1.3GB input file, the application will require ~4GB of free memory. Due to the threading model a 64bit environment is recommended.
                                            </TextBlock>

                                            <TextBlock TextWrapping="Wrap" Grid.Row="0" Margin="0,10,20,10">
                                                PHASE v2.1 is an implementation for a haplotype detection algorithm, built around a coalescent-based hidden Markov model, and designed for population-based statistical phasing. PHASE has been integrated into Ploidulator to calculate the probable number of haplotypes per cluster from the probable genotypes of each individual in the cluster.
                                                
                                            </TextBlock>
                                        </WrapPanel>
                                        
                                        

                                    </Grid>
                                </Border>
                            </Expander>

                        </Grid>
                    </ScrollViewer>
                </TabItem>

            </TabControl>

        </Grid>

    </DockPanel>
</Window>
